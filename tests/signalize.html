<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>Test</title>
    <script src="https://cdn.jsdelivr.net/gh/nuxodin/lazyfill@main/mod.min.js"></script>
<body>

<h1>Test</h1>

<script type=module>

// local storage

import {item, effect, signalize } from "../item.js";

const itm = item({outer:'0', inner:'0'});
signalize(itm);


effect(()=>{

    log("outer effect, value:" + itm.item('outer').value);

    effect(()=>{

        log("inner effect, value:" + itm.item('inner').value);

    });

});

function log(msg){
    document.body.insertAdjacentHTML('beforeend', msg+"<br>");
    console.log(msg)
}

log('<br>start mutating<br>');

itm.item('inner').value = '2';
itm.item('outer').value = '2';

log("<br>new values (skiped because batched)<br>");

itm.item('inner').value = '3';
itm.item('outer').value = '3';

log("<br>new values<br>");

setTimeout(()=>{
    log("<br>new values after 50ms<br>");
    itm.item('inner').value = '4';
    itm.item('outer').value = '4';
}, 50);

setTimeout(()=>{
    log("<br>new values after 100ms<br>");
    itm.item('inner').value = '5';
    itm.item('outer').value = '5';
}, 100);

</script>