<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>Test</title>
    <script src="https://cdn.jsdelivr.net/gh/nuxodin/lazyfill@main/mod.min.js"></script>
<body>

<h1>Test</h1>

<script type=module>

// local storage

import {cookies} from "../drivers/cookies.js";


const item = cookies();
window.random = item.item('random');

random.addEventListener('change', async ({detail}) => {
    const value = await detail.item;
    const old = detail.oldValue;
    document.body.insertAdjacentHTML('beforeend', 'change cookie, old: '+old+', new:'+value+'<br>');
});


setTimeout(async () => {
    const value = await random;
    random.value = value;
}, 1);

setTimeout(async () => {
    const value = await random;
}, 100);


</script>

<div>
    <button onclick="random.value = Math.random().toString()">change cookie</button>
</div>